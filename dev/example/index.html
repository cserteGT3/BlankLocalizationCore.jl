<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Complex 3D example · BlankLocalizationCore.jl</title><meta name="title" content="Complex 3D example · BlankLocalizationCore.jl"/><meta property="og:title" content="Complex 3D example · BlankLocalizationCore.jl"/><meta property="twitter:title" content="Complex 3D example · BlankLocalizationCore.jl"/><meta name="description" content="Documentation for BlankLocalizationCore.jl."/><meta property="og:description" content="Documentation for BlankLocalizationCore.jl."/><meta property="twitter:description" content="Documentation for BlankLocalizationCore.jl."/><meta property="og:url" content="https://cserteGT3.github.io/BlankLocalizationCore.jl/example/"/><meta property="twitter:url" content="https://cserteGT3.github.io/BlankLocalizationCore.jl/example/"/><link rel="canonical" href="https://cserteGT3.github.io/BlankLocalizationCore.jl/example/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">BlankLocalizationCore.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../example-2d/">Short 2D example</a></li><li class="is-active"><a class="tocitem" href>Complex 3D example</a><ul class="internal"><li><a class="tocitem" href="#Getting-started"><span>Getting started</span></a></li><li><a class="tocitem" href="#Example-part"><span>Example part</span></a></li><li><a class="tocitem" href="#Part-zeros"><span>Part zeros</span></a></li><li><a class="tocitem" href="#Machined-features"><span>Machined features</span></a></li><li><a class="tocitem" href="#Rough-features"><span>Rough features</span></a></li><li><a class="tocitem" href="#Pairing-the-rough-and-machined-features"><span>Pairing the rough and machined features</span></a></li><li><a class="tocitem" href="#Tolerances"><span>Tolerances</span></a></li><li><a class="tocitem" href="#Constructing-and-solving-the-optimization-problem"><span>Constructing and solving the optimization problem</span></a></li><li><a class="tocitem" href="#Evaluating-the-result"><span>Evaluating the result</span></a></li><li><a class="tocitem" href="#Visualizing-the-result"><span>Visualizing the result</span></a></li></ul></li><li><a class="tocitem" href="../api/">API extension</a></li><li><a class="tocitem" href="../reference/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Complex 3D example</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Complex 3D example</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/cserteGT3/BlankLocalizationCore.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/cserteGT3/BlankLocalizationCore.jl/blob/main/docs/src/example.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Complex-3D-example"><a class="docs-heading-anchor" href="#Complex-3D-example">Complex 3D example</a><a id="Complex-3D-example-1"></a><a class="docs-heading-anchor-permalink" href="#Complex-3D-example" title="Permalink"></a></h1><p>This example can be found as a single file in the repository under the <a href="https://github.com/cserteGT3/BlankLocalizationCore.jl/blob/main/examples/example.jl"><code>examples</code></a> folder. The script file does not contain the package installation steps, though it comes with a <code>Project.toml</code> file that you can instantiate.</p><h2 id="Getting-started"><a class="docs-heading-anchor" href="#Getting-started">Getting started</a><a id="Getting-started-1"></a><a class="docs-heading-anchor-permalink" href="#Getting-started" title="Permalink"></a></h2><p>Install the necessary packages:</p><ul><li><code>Ipopt</code> (or <code>Xpress</code>)</li><li><code>Meshes</code> and <code>GLMakie</code>: only necessary for visualization</li></ul><pre><code class="language-julia hljs">] add BlankLocalizationCore Ipopt Meshes GLMakie</code></pre><h2 id="Example-part"><a class="docs-heading-anchor" href="#Example-part">Example part</a><a id="Example-part-1"></a><a class="docs-heading-anchor-permalink" href="#Example-part" title="Permalink"></a></h2><p>The following part is crafted for demonstrating purposes. The CAD files are available here: <a href="../assets/example-part-machined.stl">machined</a> and <a href="../assets/example-part-rough.stl">rough</a>. The two images below show the part from its &quot;front&quot; and &quot;back&quot; sides in its machined state.</p><p><img src="../assets/machined-front.png" alt="Machined look front"/></p><p><img src="../assets/machined-back.png" alt="Machined look back"/></p><p>All six holes needs to be machined and also their front faces, which means that there are six machined planes.</p><p>The part in its rough (to be machined) state is shown below:</p><p><img src="../assets/rough-front.png" alt="Rough look front"/></p><p><img src="../assets/rough-back.png" alt="Rough look back"/></p><p>The rough part is also designed in CAD, of course in production the dimensions of the rough part come from a measurement process. It can be seen, that the holes on the rough part are smaller, and their axes&#39; are also modified a little bit in a few cases to showcase the possibilities of the algorithm.</p><h2 id="Part-zeros"><a class="docs-heading-anchor" href="#Part-zeros">Part zeros</a><a id="Part-zeros-1"></a><a class="docs-heading-anchor-permalink" href="#Part-zeros" title="Permalink"></a></h2><p>There are three part zeros, their attributes are listed in the table below. Their axes&#39; are shown relative to the workpiece datum.</p><table><tr><th style="text-align: right">Part zero name</th><th style="text-align: right">x axis</th><th style="text-align: right">y axis</th><th style="text-align: right">z axis</th></tr><tr><td style="text-align: right">front</td><td style="text-align: right">y</td><td style="text-align: right">z</td><td style="text-align: right">x</td></tr><tr><td style="text-align: right">right</td><td style="text-align: right">-x</td><td style="text-align: right">z</td><td style="text-align: right">y</td></tr><tr><td style="text-align: right">back</td><td style="text-align: right">-y</td><td style="text-align: right">z</td><td style="text-align: right">-x</td></tr></table><p>They can be defined in julia like this.</p><pre><code class="language-julia hljs">using BlankLocalizationCore

## Part zero definitions

pzf = PartZero(&quot;front&quot;, [0,0,0], hcat([0,1,0], [0,0,1], [1,0,0]))
pzr = PartZero(&quot;right&quot;, [0,0,0], hcat([-1, 0, 0], [0, 0, 1], [0, 1, 0]))
pzb = PartZero(&quot;back&quot;, [0,0,0], hcat([0, -1, 0], [0, 0, 1], [-1, 0, 0]))

partzeros = [pzf, pzr, pzb]</code></pre><p>When constructing a part zero, a default <code>[0,0,0]</code> position is set, as the goal of the optimization process is to find the values of those position. For more details see the docs of <a href="../reference/#BlankLocalizationCore.PartZero"><code>PartZero</code></a>.</p><h2 id="Machined-features"><a class="docs-heading-anchor" href="#Machined-features">Machined features</a><a id="Machined-features-1"></a><a class="docs-heading-anchor-permalink" href="#Machined-features" title="Permalink"></a></h2><p>The following are the features&#39; positions (six holes and six faces):</p><table><tr><th style="text-align: right">Name</th><th style="text-align: right">Part zero name</th><th style="text-align: right">Position (relative to part zero)</th><th style="text-align: right">Radius (if hole)</th></tr><tr><td style="text-align: right">front hole</td><td style="text-align: right">front</td><td style="text-align: right">[0, 0, 0]</td><td style="text-align: right">29</td></tr><tr><td style="text-align: right">front face</td><td style="text-align: right">front</td><td style="text-align: right">[0, 0, 0]</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">right hole 1</td><td style="text-align: right">right</td><td style="text-align: right">[16, 15, 0]</td><td style="text-align: right">7.5</td></tr><tr><td style="text-align: right">right hole 2</td><td style="text-align: right">right</td><td style="text-align: right">[25, -16, 3]</td><td style="text-align: right">9</td></tr><tr><td style="text-align: right">right hole 3</td><td style="text-align: right">right</td><td style="text-align: right">[60, 0, -3]</td><td style="text-align: right">13.5</td></tr><tr><td style="text-align: right">right face 1</td><td style="text-align: right">right</td><td style="text-align: right">[16, 15, 0]</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">right face 2</td><td style="text-align: right">right</td><td style="text-align: right">[25, -16, 3]</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">right face 3</td><td style="text-align: right">right</td><td style="text-align: right">[60, 0, -3]</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">back hole 1</td><td style="text-align: right">back</td><td style="text-align: right">[-14, 14, 0]</td><td style="text-align: right">9</td></tr><tr><td style="text-align: right">back hole 2</td><td style="text-align: right">back</td><td style="text-align: right">[14, 14, 0]</td><td style="text-align: right">9</td></tr><tr><td style="text-align: right">back face 1</td><td style="text-align: right">back</td><td style="text-align: right">[-14, 14, 0]</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">back face 2</td><td style="text-align: right">back</td><td style="text-align: right">[14, 14, 0]</td><td style="text-align: right"></td></tr></table><p>The machined geometries are represented with primitive features, and can be done this way:</p><pre><code class="language-julia hljs">## Machined geometry definitions

fronthole_m = SimpleHole([0, 0, 0], 29)
frontface_m = SimplePlane([0, 0, 0])

righthole1_m = SimpleHole([16, 15, 0], 7.5)
righthole2_m = SimpleHole([25, -16, 3], 9)
righthole3_m = SimpleHole([60, 0, -3], 13.5)
rightface1_m = SimplePlane([16, 15, 0])
rightface2_m = SimplePlane([25, -16, 3])
rightface3_m = SimplePlane([60, 0, -3])

backhole1_m = SimpleHole([-14, 14, 0], 9)
backhole2_m = SimpleHole([14, 14, 0], 9)
backface1_m = SimplePlane([-14, 14, 0])
backface2_m = SimplePlane([14, 14, 0])</code></pre><p>Holes are defined with their CNC machining position relative to their corresponding part zero, and their radius. Planes are defined with their position relative to their part zero. Orientation of the hole axes and plane normals are defined by their part zero (z axis).</p><h2 id="Rough-features"><a class="docs-heading-anchor" href="#Rough-features">Rough features</a><a id="Rough-features-1"></a><a class="docs-heading-anchor-permalink" href="#Rough-features" title="Permalink"></a></h2><p>The rough features are measured relative to the workpiece datum and are listed below.</p><table><tr><th style="text-align: right">Name</th><th style="text-align: right">Position (relative to part zero)</th><th style="text-align: right">Radius (if hole)</th></tr><tr><td style="text-align: right">front hole</td><td style="text-align: right">[82.5, 30, 40]</td><td style="text-align: right">26</td></tr><tr><td style="text-align: right">front face</td><td style="text-align: right">[82.5, 30, 40]</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">right hole 1</td><td style="text-align: right">[66, 71.5, 55]</td><td style="text-align: right">6</td></tr><tr><td style="text-align: right">right hole 2</td><td style="text-align: right">[58, 74.5, 24]</td><td style="text-align: right">4.905</td></tr><tr><td style="text-align: right">right hole 3</td><td style="text-align: right">[21.5, 68.5, 40]</td><td style="text-align: right">16</td></tr><tr><td style="text-align: right">right face 1</td><td style="text-align: right">[66, 71.5, 55]</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">right face 2</td><td style="text-align: right">[58, 74.5, 24]</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">right face 3</td><td style="text-align: right">[21.5, 68.5, 40]</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">back hole 1</td><td style="text-align: right">[-3, 44, 53.9]</td><td style="text-align: right">6.2</td></tr><tr><td style="text-align: right">back hole 2</td><td style="text-align: right">[-3, 16.1, 54]</td><td style="text-align: right">6.25</td></tr><tr><td style="text-align: right">back face 1</td><td style="text-align: right">[-3, 44, 54]</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">back face 2</td><td style="text-align: right">[-3, 16, 54]</td><td style="text-align: right"></td></tr></table><p>In julia we define primitive features just like before. Note that a plane normal is given, that is only used later when visualizing the planes.</p><pre><code class="language-julia hljs">## Rough geometry definitions

fronthole_r = HoleAndNormal([82.5, 30, 40], [1, 0, 0], 26)
frontface_r = PlaneAndNormal([82.5, 30, 40], [1, 0, 0])

righthole1_r = HoleAndNormal([66, 71.5, 55], [0, 1, 0], 6)
righthole2_r = HoleAndNormal([58, 74.5, 24], [0, 1, 0], 4.905)
righthole3_r = HoleAndNormal([21.5, 68.5, 40], [0, 1, 0], 8)
rightface1_r = PlaneAndNormal([66, 71.5, 55], [0, 1, 0])
rightface2_r = PlaneAndNormal([58, 74.5, 24], [0, 1, 0])
rightface3_r = PlaneAndNormal([21.5, 68.5, 40], [0, 1, 0])

backhole1_r = HoleAndNormal([-3, 44, 53.9], [-1, 0, 0], 6.2)
backhole2_r = HoleAndNormal([-3, 16.1, 54], [-1, 0, 0], 6.25)
backface1_r = PlaneAndNormal([-3, 44, 54], [-1, 0, 0])
backface2_r = PlaneAndNormal([-3, 16, 54], [-1, 0, 0])</code></pre><h2 id="Pairing-the-rough-and-machined-features"><a class="docs-heading-anchor" href="#Pairing-the-rough-and-machined-features">Pairing the rough and machined features</a><a id="Pairing-the-rough-and-machined-features-1"></a><a class="docs-heading-anchor-permalink" href="#Pairing-the-rough-and-machined-features" title="Permalink"></a></h2><p>To create <a href="../reference/#BlankLocalizationCore.LocalizationFeature"><code>LocalizationFeature</code></a>s, that will be subject to the optimizatio, a <a href="../reference/#BlankLocalizationCore.FeatureDescriptor"><code>FeatureDescriptor</code></a> is needed to be defined for each. This &quot;joins&quot; a rough and machined geometry, and contains information such as the name and part zero of the feature and if a feature has a machined and rough state. (There are cases, when this can be important, for this example all features have machined and rough state).</p><p>This will look like this in julia:</p><pre><code class="language-julia hljs">## Geometry pairing and feature descriptors

# Feature descriptors for each feature

fd_fronthole = FeatureDescriptor(&quot;fronthole&quot;, pzf, true, true)
fd_frontface = FeatureDescriptor(&quot;frontface&quot;, pzf, true, true)

fd_righthole1 = FeatureDescriptor(&quot;righthole1&quot;, pzr, true, true)
fd_righthole2 = FeatureDescriptor(&quot;righthole2&quot;, pzr, true, true)
fd_righthole3 = FeatureDescriptor(&quot;righthole3&quot;, pzr, true, true)
fd_rightface1 = FeatureDescriptor(&quot;rightface1&quot;, pzr, true, true)
fd_rightface2 = FeatureDescriptor(&quot;rightface2&quot;, pzr, true, true)
fd_rightface3 = FeatureDescriptor(&quot;rightface3&quot;, pzr, true, true)

fd_backhole1 = FeatureDescriptor(&quot;backhole1&quot;, pzb, true, true)
fd_backhole2 = FeatureDescriptor(&quot;backhole2&quot;, pzb, true, true)
fd_backface1 = FeatureDescriptor(&quot;backface1&quot;, pzb, true, true)
fd_backface2 = FeatureDescriptor(&quot;backface2&quot;, pzb, true, true)

# Hole features

holes = [HoleLocalizationFeature(fd_fronthole, fronthole_r, fronthole_m),
    HoleLocalizationFeature(fd_righthole1, righthole1_r, righthole1_m),
    HoleLocalizationFeature(fd_righthole2, righthole2_r, righthole2_m),
    HoleLocalizationFeature(fd_righthole3, righthole3_r, righthole3_m),
    HoleLocalizationFeature(fd_backhole1, backhole1_r, backhole1_m),
    HoleLocalizationFeature(fd_backhole2, backhole2_r, backhole2_m)
    ]

# Face features
planes = [PlaneLocalizationFeature(fd_frontface, frontface_r, frontface_m),
PlaneLocalizationFeature(fd_rightface1, rightface1_r, rightface1_m),
PlaneLocalizationFeature(fd_rightface2, rightface2_r, rightface2_m),
PlaneLocalizationFeature(fd_rightface3, rightface3_r, rightface3_m),
PlaneLocalizationFeature(fd_backface1, backface1_r, backface1_m),
PlaneLocalizationFeature(fd_backface2, backface2_r, backface2_m)
]</code></pre><h2 id="Tolerances"><a class="docs-heading-anchor" href="#Tolerances">Tolerances</a><a id="Tolerances-1"></a><a class="docs-heading-anchor-permalink" href="#Tolerances" title="Permalink"></a></h2><p>A tolerance is described between two feature (their feature point to be precise), and their distance is calculated with a certain projection (usually projection to one of the axis of the workpiece datum, but any R^3-&gt;R transformation can be used). This projected distance must be between the lower and upper values of the tolerance. Tolerance can be defined between both rough and/or machined features.</p><p>For this example, the tolerances are created based on the drawing of the machined part. This is the drawing, which only contains dimensions related to the optimization problem. It is also available as a pdf <a href="../assets/example-part-machined-tolerances.pdf">here</a>.</p><p><img src="../assets/example-part-machined-tolerances.png" alt="Tolerances"/></p><p>Axes in the &quot;Pojection&quot; column mean the axes of the workpiece datum. The distance of the two features&#39; feature points are projected to those axes.</p><table><tr><th style="text-align: right">{#}</th><th style="text-align: right">F1 name</th><th style="text-align: right">F1: machined/rough</th><th style="text-align: right">Projection</th><th style="text-align: right">F2 name</th><th style="text-align: right">F2: machined/rough</th><th style="text-align: right">Nominal value</th><th style="text-align: right">Lower value</th><th style="text-align: right">Upper value</th></tr><tr><td style="text-align: right">1</td><td style="text-align: right">right face 1</td><td style="text-align: right">machined</td><td style="text-align: right">y axis</td><td style="text-align: right">front hole</td><td style="text-align: right">machined</td><td style="text-align: right">41</td><td style="text-align: right">40.7</td><td style="text-align: right">41.3</td></tr><tr><td style="text-align: right">2</td><td style="text-align: right">back hole 1</td><td style="text-align: right">machined</td><td style="text-align: right">y axis</td><td style="text-align: right">front hole</td><td style="text-align: right">machined</td><td style="text-align: right">14</td><td style="text-align: right">13.8</td><td style="text-align: right">14.2</td></tr><tr><td style="text-align: right">3</td><td style="text-align: right">front hole</td><td style="text-align: right">machined</td><td style="text-align: right">y axis</td><td style="text-align: right">back hole 2</td><td style="text-align: right">machined</td><td style="text-align: right">14</td><td style="text-align: right">13.8</td><td style="text-align: right">14.2</td></tr><tr><td style="text-align: right">4</td><td style="text-align: right">back hole 1</td><td style="text-align: right">machined</td><td style="text-align: right">z axis</td><td style="text-align: right">front hole</td><td style="text-align: right">machined</td><td style="text-align: right">14</td><td style="text-align: right">13.8</td><td style="text-align: right">14.2</td></tr><tr><td style="text-align: right">5</td><td style="text-align: right">back hole 2</td><td style="text-align: right">machined</td><td style="text-align: right">z axis</td><td style="text-align: right">front hole</td><td style="text-align: right">machined</td><td style="text-align: right">14</td><td style="text-align: right">13.8</td><td style="text-align: right">14.2</td></tr><tr><td style="text-align: right">6</td><td style="text-align: right">right face 3</td><td style="text-align: right">machined</td><td style="text-align: right">y axis</td><td style="text-align: right">front hole</td><td style="text-align: right">machined</td><td style="text-align: right">38</td><td style="text-align: right">37.7</td><td style="text-align: right">38.3</td></tr><tr><td style="text-align: right">7</td><td style="text-align: right">right face 2</td><td style="text-align: right">machined</td><td style="text-align: right">y axis</td><td style="text-align: right">front hole</td><td style="text-align: right">machined</td><td style="text-align: right">44</td><td style="text-align: right">43.7</td><td style="text-align: right">44.3</td></tr><tr><td style="text-align: right">8</td><td style="text-align: right">front face</td><td style="text-align: right">machined</td><td style="text-align: right">x axis</td><td style="text-align: right">right hole 3</td><td style="text-align: right">machined</td><td style="text-align: right">60</td><td style="text-align: right">59.7</td><td style="text-align: right">60.3</td></tr><tr><td style="text-align: right">9</td><td style="text-align: right">front face</td><td style="text-align: right">machined</td><td style="text-align: right">x axis</td><td style="text-align: right">right hole 2</td><td style="text-align: right">machined</td><td style="text-align: right">25</td><td style="text-align: right">24.8</td><td style="text-align: right">25.2</td></tr><tr><td style="text-align: right">10</td><td style="text-align: right">front face</td><td style="text-align: right">machined</td><td style="text-align: right">x axis</td><td style="text-align: right">right hole 1</td><td style="text-align: right">machined</td><td style="text-align: right">16</td><td style="text-align: right">15.8</td><td style="text-align: right">16.2</td></tr><tr><td style="text-align: right">11</td><td style="text-align: right">right hole 1</td><td style="text-align: right">machined</td><td style="text-align: right">z axis</td><td style="text-align: right">front hole</td><td style="text-align: right">machined</td><td style="text-align: right">15</td><td style="text-align: right">14.8</td><td style="text-align: right">15.2</td></tr><tr><td style="text-align: right">12</td><td style="text-align: right">front hole</td><td style="text-align: right">machined</td><td style="text-align: right">z axis</td><td style="text-align: right">right hole 2</td><td style="text-align: right">machined</td><td style="text-align: right">16</td><td style="text-align: right">15.8</td><td style="text-align: right">16.2</td></tr><tr><td style="text-align: right">13</td><td style="text-align: right">front face</td><td style="text-align: right">machined</td><td style="text-align: right">x axis</td><td style="text-align: right">back face 1</td><td style="text-align: right">rough</td><td style="text-align: right">85</td><td style="text-align: right">84.6</td><td style="text-align: right">85.4</td></tr><tr><td style="text-align: right">14</td><td style="text-align: right">front face</td><td style="text-align: right">machined</td><td style="text-align: right">x axis</td><td style="text-align: right">back face 2</td><td style="text-align: right">rough</td><td style="text-align: right">85</td><td style="text-align: right">84.6</td><td style="text-align: right">85.4</td></tr><tr><td style="text-align: right">15</td><td style="text-align: right">right hole 3</td><td style="text-align: right">machined</td><td style="text-align: right">z axis</td><td style="text-align: right">front hole</td><td style="text-align: right">machined</td><td style="text-align: right">0</td><td style="text-align: right">-0.2</td><td style="text-align: right">0.2</td></tr></table><p>To express these tolerances in julia, the following code is used. The above table is changed with the followings:</p><ul><li>Those feature names are used, that we defined in the <code>FeatureDescriptor</code>s.</li><li>Where the machined state of a feature is used, a <code>true</code> used, and <code>false</code> for rough state.</li><li>Three functions are defined that do the projection: <code>xfunc</code>, <code>yfunc</code>, <code>zfunc</code>. Those are passed to the struct constructor.</li><li>The julia struct also contains a note string, the numbering of the tolerances are given there for this example.</li></ul><pre><code class="language-julia hljs">## Tolerances

xfunc(x) = x[1]
yfunc(x) = x[2]
zfunc(x) = x[3]

tolerances = [Tolerance(&quot;rightface1&quot;, true, yfunc, &quot;fronthole&quot;, true, 41, 40.7, 41.3, &quot;1&quot;),
Tolerance(&quot;backhole1&quot;, true, yfunc, &quot;fronthole&quot;, true, 14, 13.8, 14.2, &quot;2&quot;),
Tolerance(&quot;fronthole&quot;, true, yfunc, &quot;backhole2&quot;, true, 14, 13.8, 14.2, &quot;3&quot;),
Tolerance(&quot;backhole1&quot;, true, zfunc, &quot;fronthole&quot;, true, 14, 13.8, 14.2, &quot;4&quot;),
Tolerance(&quot;backhole2&quot;, true, zfunc, &quot;fronthole&quot;, true, 14, 13.8, 14.2, &quot;5&quot;),
Tolerance(&quot;rightface3&quot;, true, yfunc, &quot;fronthole&quot;, true, 38, 37.7, 38.3, &quot;6&quot;),
Tolerance(&quot;rightface2&quot;, true, yfunc, &quot;fronthole&quot;, true, 44, 43.7, 44.3, &quot;7&quot;),
Tolerance(&quot;frontface&quot;, true, xfunc, &quot;righthole3&quot;, true, 60, 59.7, 60.3, &quot;8&quot;),
Tolerance(&quot;frontface&quot;, true, xfunc, &quot;righthole2&quot;, true, 25, 24.8, 25.2, &quot;9&quot;),
Tolerance(&quot;frontface&quot;, true, xfunc, &quot;righthole1&quot;, true, 16, 15.8, 16.2, &quot;10&quot;),
Tolerance(&quot;righthole1&quot;, true, zfunc, &quot;fronthole&quot;, true, 15, 14.8, 15.2, &quot;11&quot;),
Tolerance(&quot;fronthole&quot;, true, zfunc, &quot;righthole2&quot;, true, 16, 15.8, 16.2, &quot;12&quot;),
Tolerance(&quot;frontface&quot;, true, xfunc, &quot;backface1&quot;, false, 85, 84.6, 85.4, &quot;13&quot;),
Tolerance(&quot;frontface&quot;, true, xfunc, &quot;backface2&quot;, false, 85, 84.6, 85.4, &quot;14&quot;),
Tolerance(&quot;righthole3&quot;, true, zfunc, &quot;fronthole&quot;, true, 0, -0.2, 0.2, &quot;15&quot;)]</code></pre><h2 id="Constructing-and-solving-the-optimization-problem"><a class="docs-heading-anchor" href="#Constructing-and-solving-the-optimization-problem">Constructing and solving the optimization problem</a><a id="Constructing-and-solving-the-optimization-problem-1"></a><a class="docs-heading-anchor-permalink" href="#Constructing-and-solving-the-optimization-problem" title="Permalink"></a></h2><p>A few parameters are needed for the optimization problem, passed to the object as a dictionary. These are:</p><table><tr><th style="text-align: left">Name (key)</th><th style="text-align: left">Description</th><th style="text-align: right">Suggested value</th><th style="text-align: right">Required?</th></tr><tr><td style="text-align: left">minAllowance</td><td style="text-align: left">Minimum allowance that must be achieved even by the lowest value.</td><td style="text-align: right"><code>0.1</code></td><td style="text-align: right">Required</td></tr><tr><td style="text-align: left">OptimizeForToleranceCenter</td><td style="text-align: left">The default method is to optimize for the middle (center) of the tolerance fields. For debugging, one can set it to <code>false</code>, then the minimum allowance will be maximised (ignoring the <code>minAllowance</code> value).</td><td style="text-align: right"><code>true</code></td><td style="text-align: right">Required</td></tr><tr><td style="text-align: left">UseTolerances</td><td style="text-align: left">Also a debugging feature. Tolerance lower-upper values are added as active constraints on the distance of the corresponding features. This can be turned off with this flag.</td><td style="text-align: right"><code>true</code></td><td style="text-align: right">Required</td></tr><tr><td style="text-align: left">SetPartZeroPosition</td><td style="text-align: left">The position of each part zero can be set with this option. A vector of 3 long vectors is expected, that is matched with the number of part zeros. Empty vectors can be passed, if not all part zero positions should be set. For example setting this option to <code>[[], [], []]</code> for three part zeros will have no effect. <code>NaN</code> elements are ignored, which means that specific axes of part zeros can be set. For example <code>[[NaN, 150, Nan], [], []]</code> would only set the value of the Y axis of the first part zero, all others are unaffected.</td><td style="text-align: right"></td><td style="text-align: right">Optional</td></tr><tr><td style="text-align: left">maxPlaneZAllowance</td><td style="text-align: left">The allowance has no upper bound by default. For planes, it is possible to set an upper bound to avoid the issue of &quot;machining the whole part away&quot;.</td><td style="text-align: right"></td><td style="text-align: right">Optional</td></tr></table><p>An optimization solver is needed for which we use <a href="https://github.com/jump-dev/Xpress.jl">Xpress.jl</a> in our research. A license is required for FICO Xpress (though the generated problem size does not exceed the limit of the (free) community license). The <a href="https://github.com/jump-dev/Ipopt.jl">Ipopt</a> and <a href="https://github.com/scipopt/SCIP.jl">SCIP</a> solvers were also tested and can be used. We use the former in this example.</p><pre><code class="language-julia hljs">## Constructing and solving the optimization problem
pard = Dict(&quot;minAllowance&quot;=&gt;0.5, &quot;OptimizeForToleranceCenter&quot;=&gt;true,
    &quot;UseTolerances&quot;=&gt;true, &quot;maxPlaneZAllowance&quot;=&gt;1);

mop = MultiOperationProblem(partzeros, holes, planes, tolerances, pard)

import Ipopt # or Xpress if you have a license
optimizeproblem!(mop, Ipopt.Optimizer)

#=
# the following lines are condensed in the above one line: 
import JuMP
mop_model = createjumpmodel(mop, Xpress.Optimizer);
JuMP.optimize!(mop_model)
setjumpresult!(mop, mop_model)
=#</code></pre><h2 id="Evaluating-the-result"><a class="docs-heading-anchor" href="#Evaluating-the-result">Evaluating the result</a><a id="Evaluating-the-result-1"></a><a class="docs-heading-anchor-permalink" href="#Evaluating-the-result" title="Permalink"></a></h2><p>Two tables are available for analyzing the result: the allowance and tolerance tables. Copying them from the REPL looks like this:</p><pre><code class="language-julia-repl hljs">julia&gt; printallowancetable(mop)
                                                      Allowance table Min allowance radial: 1.489 axial: 0.500
┌────────────┬──────────────┬───────────┬───────────┬───────────┬────────┬────────┬────────┬───────────┬────────┬────────────┬───────────┬────────────┬─────────────┐
│       name │ partzeroname │ machinedx │ machinedy │ machinedz │ roughx │ roughy │ roughz │ machinedr │ roughr │ xydistance │ zdistance │ rallowance │ axallowance │
├────────────┼──────────────┼───────────┼───────────┼───────────┼────────┼────────┼────────┼───────────┼────────┼────────────┼───────────┼────────────┼─────────────┤
│  fronthole │        front │      82.0 │   29.7558 │   39.9886 │   82.5 │   30.0 │   40.0 │      29.0 │   26.0 │    0.24448 │           │    2.75552 │             │
│ righthole1 │        right │      66.0 │   70.7558 │   54.9886 │   66.0 │   71.5 │   55.0 │       7.5 │    6.0 │  0.0114074 │           │    1.48859 │             │
│ righthole2 │        right │      57.0 │   73.7558 │   23.9886 │   58.0 │   74.5 │   24.0 │       9.0 │  4.905 │    1.00007 │           │    3.09493 │             │
│ righthole3 │        right │      22.0 │   67.7558 │   39.9886 │   21.5 │   68.5 │   40.0 │      13.5 │    8.0 │    0.50013 │           │    4.99987 │             │
│  backhole1 │         back │     -2.25 │   43.7558 │   53.9886 │   -3.0 │   44.0 │   53.9 │       9.0 │    6.2 │   0.259786 │           │    2.54021 │             │
│  backhole2 │         back │     -2.25 │   15.7558 │   53.9886 │   -3.0 │   16.1 │   54.0 │       9.0 │   6.25 │   0.344403 │           │     2.4056 │             │
│  frontface │        front │      82.0 │   29.7558 │   39.9886 │   82.5 │   30.0 │   40.0 │           │        │            │      -0.5 │            │         0.5 │
│ rightface1 │        right │      66.0 │   70.7558 │   54.9886 │   66.0 │   71.5 │   55.0 │           │        │            │ -0.744214 │            │    0.744214 │
│ rightface2 │        right │      57.0 │   73.7558 │   23.9886 │   58.0 │   74.5 │   24.0 │           │        │            │ -0.744214 │            │    0.744214 │
│ rightface3 │        right │      22.0 │   67.7558 │   39.9886 │   21.5 │   68.5 │   40.0 │           │        │            │ -0.744214 │            │    0.744214 │
│  backface1 │         back │     -2.25 │   43.7558 │   53.9886 │   -3.0 │   44.0 │   54.0 │           │        │            │     -0.75 │            │        0.75 │
│  backface2 │         back │     -2.25 │   15.7558 │   53.9886 │   -3.0 │   16.0 │   54.0 │           │        │            │     -0.75 │            │        0.75 │
└────────────┴──────────────┴───────────┴───────────┴───────────┴────────┴────────┴────────┴───────────┴────────┴────────────┴───────────┴────────────┴─────────────┘

julia&gt; printtolerancetable(mop)
                                                     Tolerance table avgabsreltolerror: 0.0%
┌───────┬──────────────┬───────────┬──────────────┬───────────┬──────────┬────────┬────────┬────────────────────────────┬───────┬────────────────┐
│ Tol # │     feature1 │ partzero1 │     feature2 │ partzero2 │ nominald │ lowerd │ upperd │                   distance │ reald │ tolerancefield │
├───────┼──────────────┼───────────┼──────────────┼───────────┼──────────┼────────┼────────┼────────────────────────────┼───────┼────────────────┤
│     1 │ M rightface1 │     right │  M fronthole │     front │     41.0 │   40.7 │   41.3 │        [-16.0, 41.0, 15.0] │  41.0 │          0.0 % │
│     2 │  M backhole1 │      back │  M fronthole │     front │     14.0 │   13.8 │   14.2 │       [-84.25, 14.0, 14.0] │  14.0 │         -0.0 % │
│     3 │  M fronthole │     front │  M backhole2 │      back │     14.0 │   13.8 │   14.2 │       [84.25, 14.0, -14.0] │  14.0 │          0.0 % │
│     4 │  M backhole1 │      back │  M fronthole │     front │     14.0 │   13.8 │   14.2 │       [-84.25, 14.0, 14.0] │  14.0 │          0.0 % │
│     5 │  M backhole2 │      back │  M fronthole │     front │     14.0 │   13.8 │   14.2 │      [-84.25, -14.0, 14.0] │  14.0 │          0.0 % │
│     6 │ M rightface3 │     right │  M fronthole │     front │     38.0 │   37.7 │   38.3 │         [-60.0, 38.0, 0.0] │  38.0 │          0.0 % │
│     7 │ M rightface2 │     right │  M fronthole │     front │     44.0 │   43.7 │   44.3 │       [-25.0, 44.0, -16.0] │  44.0 │          0.0 % │
│     8 │  M frontface │     front │ M righthole3 │     right │     60.0 │   59.7 │   60.3 │         [60.0, -38.0, 0.0] │  60.0 │          0.0 % │
│     9 │  M frontface │     front │ M righthole2 │     right │     25.0 │   24.8 │   25.2 │        [25.0, -44.0, 16.0] │  25.0 │          0.0 % │
│    10 │  M frontface │     front │ M righthole1 │     right │     16.0 │   15.8 │   16.2 │       [16.0, -41.0, -15.0] │  16.0 │          0.0 % │
│    11 │ M righthole1 │     right │  M fronthole │     front │     15.0 │   14.8 │   15.2 │        [-16.0, 41.0, 15.0] │  15.0 │          0.0 % │
│    12 │  M fronthole │     front │ M righthole2 │     right │     16.0 │   15.8 │   16.2 │        [25.0, -44.0, 16.0] │  16.0 │          0.0 % │
│    13 │  M frontface │     front │  R backface1 │      back │     85.0 │   84.6 │   85.4 │ [85.0, -14.2442, -14.0114] │  85.0 │         -0.0 % │
│    14 │  M frontface │     front │  R backface2 │      back │     85.0 │   84.6 │   85.4 │  [85.0, 13.7558, -14.0114] │  85.0 │         -0.0 % │
│    15 │ M righthole3 │     right │  M fronthole │     front │      0.0 │   -0.2 │    0.2 │         [-60.0, 38.0, 0.0] │   0.0 │          0.0 % │
└───────┴──────────────┴───────────┴──────────────┴───────────┴──────────┴────────┴────────┴────────────────────────────┴───────┴────────────────┘</code></pre><h2 id="Visualizing-the-result"><a class="docs-heading-anchor" href="#Visualizing-the-result">Visualizing the result</a><a id="Visualizing-the-result-1"></a><a class="docs-heading-anchor-permalink" href="#Visualizing-the-result" title="Permalink"></a></h2><p>For visualization the Meshes and Makie ecosystems are used. The idea is to &quot;convert&quot; the <code>BlankLocalizationCore</code> objects to Meshes objects, that can be then visualized with the Meshes-Makie package extension. After loading Makie and Meshes, the <code>viz</code> and <code>viz!</code> functions should be available.</p><p>I wrote a small function that creates a <code>Makie.FigureAxisPlot</code>, which we can then use to plot into. Not that sophisticated I know.</p><pre><code class="language-julia hljs">import GLMakie

using Meshes

function initviz(;hideaxes=false)
    f = viz([Point(i, j, k) for i in 0:1 for j in 0:1 for k in 0:1], size=0.01, color=:white)
    if hideaxes
        f.axis.show_axis[] = false
    end
    f
end</code></pre><p>Then, the with the following functions we can generate Meshes objects, then visualize them with the <code>viz</code> or <code>viz!</code> functions.</p><pre><code class="language-julia hljs">rholes = genroughholes(mop)
mholes = genmachinedholes(mop)
mplanes = genmachinedplanes(mop)
rplanes = genroughplanes(mop)

f = initviz(hideaxes=false)
viz!.(rholes, alpha=0.5, color=:red)
viz!.(mholes, alpha=0.5, color=:blue)
viz!.(rplanes, alpha=0.5, color=:red)
viz!.(mplanes, alpha=0.5, color=:blue)
#GLMakie.save(&quot;example-part.png&quot;, f)</code></pre><p><img src="../assets/example-part-makie.png" alt="Visualization"/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../example-2d/">« Short 2D example</a><a class="docs-footer-nextpage" href="../api/">API extension »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.11.4 on <span class="colophon-date" title="Thursday 22 May 2025 13:04">Thursday 22 May 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
